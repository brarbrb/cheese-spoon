<!-- templates/course_overview.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CheeseSpoon — Course Overview</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>

<body>
  <nav id="top-navbar" class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
        <span>CheeseSpoon</span>
        <img
          src="{{ url_for('static', filename='logo.png') }}"
          alt="CheeseSpoon"
          class="brand-logo"
        />
      </a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#top-navbar-supported-content">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div id="top-navbar-supported-content" class="collapse navbar-collapse">
        <ul class="navbar-nav ml-auto align-items-lg-center">
          <li class="nav-item">
            <a class="btn btn-sm btn-outline-secondary mr-lg-2"
               href="{{ url_for('index') }}">
              Home
            </a>
          </li>

          <li class="nav-item">
            <a class="btn btn-sm btn-outline-secondary mr-lg-2"
               href="{{ url_for('upload') }}">
              Build schedule
            </a>
          </li>

          <!-- <li class="nav-item">
            <a class="btn btn-sm btn-dark"
               href="{{ url_for('course_overview') }}">
              Course overview
            </a>
          </li> -->
        </ul>
      </div>

    </div>
  </nav>

  <main class="container my-4">
    <div class="row justify-content-center">
      <div class="col-lg-10">

        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="alert alert-secondary" role="alert">
              {{ messages[0] }}
            </div>
          {% endif %}
        {% endwith %}

        <!-- Search / Enter course id -->
<div class="feature-card p-4 mb-3" style="height:auto; min-height:auto;">
          <div class="d-flex justify-content-between align-items-start flex-wrap">
            <div class="mb-2">
              <h4 class="mb-1">Course overview</h4>
              <div class="muted small">
                Enter a course number — we’ll generate an objective summary from reviews + syllabus + scraped metadata.
              </div>
            </div>

            <div class="text-right muted small">
              Try: <span class="kbd-pill">096345</span> <span class="kbd-pill">094332</span> <span class="kbd-pill">094123</span>
            </div>
          </div>

<form class="mt-3" method="POST">
  <div class="form-row">
    <div class="form-group col-md-8 mb-2">
      <label class="muted small mb-1"><strong>Course number</strong></label>
      <input
        class="form-control"
        name="course_id"
        inputmode="numeric"
        placeholder="e.g., 096345"
        value="{{ query }}"
        required
      />
    </div>

    <div class="form-group col-md-4 mb-2 d-flex align-items-end">
      <button class="btn btn-dark btn-block" type="submit">
        Generate overview
      </button>
    </div>

    <!-- help text moved OUT so it won't push the button down -->
    <div class="col-12">
      <div class="muted small mt-1">Digits only. We’ll ignore spaces/dashes.</div>
    </div>
  </div>
</form>

        </div>

        {% if course %}
        <!-- Results -->
        <div class="row">
          <div class="col-lg-8">

            <!-- Header card -->
            <div class="feature-card p-3 mb-3" style="height:auto; min-height:auto;">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <div class="d-flex align-items-center flex-wrap">
                    <span class="kbd-pill mr-2">{{ course.id }}</span>
                    <h5 class="mb-0">{{ course.name }}</h5>
                    <span class="muted small ml-2">({{ "%.1f"|format(course.points) }} pts)</span>
                  </div>
                  <!-- <div class="mt-2">
                    {% for t in course.tags %}
                      <span class="badge badge-light border mr-1">{{ t }}</span>
                    {% endfor %}
                  </div> -->
                </div>

                <div class="text-right">
                  <div class="muted small">Reviews</div>
                  <div><span class="badge badge-dark badge-pill">{{ course.n_reviews }}</span></div>
                </div>
              </div>

              <div class="row mt-3">
                <div class="col-md-6">
                  <div class="muted small"><strong>Overall rating</strong></div>
                  <div class="d-flex align-items-center">
                    <div class="mr-2"><strong>{{ "%.1f"|format(course.rating_5) }}/5</strong></div>
                    <div class="fit-bar flex-grow-1">
                      <div class="fit-bar-fill" style="width: {{ (course.rating_5 / 5.0) * 100 }}%;"></div>
                    </div>
                  </div>
                </div>

                <div class="col-md-6 mt-3 mt-md-0" style="height:auto; min-height:auto;">
                  <div class="muted small"><strong>Sentiment</strong></div>
                  <div class="d-flex align-items-center">
                    <div class="mr-2"><strong>{{ course.sentiment_100 }}%</strong></div>
                    <div class="fit-bar flex-grow-1">
                      <div class="fit-bar-fill" style="width: {{ course.sentiment_100 }}%;"></div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="alert alert-light small mt-3 mb-0">
                <strong>Objective summary:</strong> {{ course.summary }}
              </div>
            </div>

            <!-- What to expect -->
            <div class="feature-card p-3 mb-3" style="height:auto; min-height:auto;">
              <div class="muted small mb-2"><strong>What to expect</strong></div>

              <div class="row">
                <div class="col-md-6">
                  <div class="muted small mb-1"><strong>Topics</strong></div>
                  <ul class="small mb-0">
                    {% for x in course.topics %}
                      <li>{{ x }}</li>
                    {% endfor %}
                  </ul>
                </div>

                <div class="col-md-6 mt-3 mt-md-0">
                  <div class="muted small mb-1"><strong>Pros / Cons</strong></div>
                  <div class="row">
                    <div class="col-6">
                      <div class="muted small">Pros</div>
                      <ul class="small mb-0">
                        {% for x in course.pros %}
                          <li>{{ x }}</li>
                        {% endfor %}
                      </ul>
                    </div>
                    <div class="col-6">
                      <div class="muted small">Cons</div>
                      <ul class="small mb-0">
                        {% for x in course.cons %}
                          <li>{{ x }}</li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quotes -->
            <div class="feature-card p-3 mb-3" style="height:auto; min-height:auto;">
              <div class="d-flex justify-content-between align-items-center">
                <div class="muted small"><strong>Representative quotes</strong></div>
                <button class="btn btn-sm btn-outline-secondary" type="button" data-toggle="collapse" data-target="#quotesCollapse">
                  Show / hide
                </button>
              </div>

              <div id="quotesCollapse" class="collapse show mt-3">
                {% for q in course.quotes %}
                  <div class="quote small">{{ q }}</div>
                {% endfor %}
                <div class="muted small mt-2">Note: quotes are shortened + anonymized.</div>
              </div>
            </div>

          </div>

          <div class="col-lg-4">
            <!-- Quick facts -->
            <div class="feature-card p-3 mb-3" style="height:auto; min-height:auto;">
              <div class="muted small mb-2"><strong>Quick facts</strong></div>

              <div class="small">
                <div class="mb-2">
                  <div class="muted small"><strong>Assessment</strong></div>
                  <div><span class="muted">Format:</span> {{ course.assessment.format }}</div>
                  <div><span class="muted">Midterms:</span> {{ course.assessment.midterms }}</div>
                  <div><span class="muted">Project:</span> {{ course.assessment.project }}</div>
                </div>

                <div class="mb-2">
                  <div class="muted small"><strong>Workload</strong></div>
                  <div><span class="muted">Label:</span> {{ course.workload.label }}</div>
                  <div><span class="muted">Hours/week:</span> {{ course.workload.hours_per_week }}</div>
                </div>

                <div class="mb-2">
                  <div class="muted small"><strong>Prerequisites</strong></div>
                  {% if course.prereqs and course.prereqs|length > 0 %}
                    <ul class="small mb-0">
                      {% for p in course.prereqs %}
                        <li>{{ p }}</li>
                      {% endfor %}
                    </ul>
                  {% else %}
                    <div class="muted small">None listed.</div>
                  {% endif %}
                </div>

                <div class="mb-0">
                  <div class="muted small"><strong>Recommended background</strong></div>
                  {% if course.recommended_background and course.recommended_background|length > 0 %}
                    <ul class="small mb-0">
                      {% for p in course.recommended_background %}
                        <li>{{ p }}</li>
                      {% endfor %}
                    </ul>
                  {% else %}
                    <div class="muted small">—</div>
                  {% endif %}
                </div>

              </div>
            </div>

            <!-- Actions -->
            <div class="feature-card p-3" style="height:auto; min-height:auto;">
              <div class="muted small mb-2"><strong>Actions</strong></div>

              <a class="btn btn-sm btn-dark btn-block" href="{{ url_for('upload') }}">
                Add to my schedule plan
              </a>

              {% if course.alternatives and course.alternatives|length > 0 %}
                <div class="muted small mt-3"><strong>Similar / follow-up courses</strong></div>
                <div class="mt-2">
                  {% for a in course.alternatives %}
                    <a class="btn btn-sm btn-outline-secondary mb-2"
                       href="{{ url_for('course_overview', course_id=a.id) }}">
                      {{ a.id }} — {{ a.name }}
                    </a><br>
                  {% endfor %}
                </div>
              {% endif %}

            </div>
          </div>
        </div>
        {% endif %}

      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>