{% extends 'base.html' %}

{% block title %}Upload Grade Sheet{% endblock %}

{% block content %}
    <div class="row justify-content-center">
      <div class="col-lg-8">

        <div class="feature-card p-4">
          <h4 class="mb-1">Upload Your Grade Sheet</h4>
          <div class="muted small mb-4">
            Step 1 of 3: Upload your Technion grade sheet to extract completed courses.
          </div>

          <form method="POST" enctype="multipart/form-data">
            <div class="form-group">
              <label class="mb-1"><strong>Grade sheet</strong></label>
              <div class="muted small mb-2">PDF format.</div>

              <div id="dropzone" class="dropzone">
                <div class="dropzone-inner">
                  <div class="dropzone-title">Drop your file here</div>
                  <div class="muted small">or click to choose a file</div>
                  <div id="fileName" class="dropzone-filename muted small mt-2" style="display:none;"></div>
                </div>

                <input
                  id="gradesFileInput"
                  type="file"
                  name="grades_file"
                  accept=".pdf,.xlsx,.xls"
                  class="dropzone-input"
                />
              </div>
            </div>

            <div class="alert alert-light small mb-4">
              <strong>What happens next?</strong>
              <ol class="mb-0 small">
                <li>We'll parse your grade sheet to extract completed courses</li>
                <li>You'll review and confirm the extracted courses</li>
                <li>You'll set your preferences and filters</li>
                <li>You'll get personalized course recommendations</li>
              </ol>
            </div>

            <div class="alert alert-light small mb-4">
              <strong>Privacy Note:</strong> We don't store the original grade sheet — only parsed course IDs.
            </div>

            <div class="d-flex justify-content-between">
              <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">Back to Home</a>              
               <button class="btn btn-dark" type="submit">Parse & Continue →</button>
            </div>
          </form>
        </div>

      </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    // File upload dropzone logic
    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("gradesFileInput");
    const fileNameEl = document.getElementById("fileName");

    function showFileName(file) {
      if (!file) {
        fileNameEl.style.display = "none";
        fileNameEl.textContent = "";
        return;
      }
      fileNameEl.style.display = "block";
      fileNameEl.textContent = `Selected: ${file.name}`;
    }

    if(fileInput) {
        // Native change event
        fileInput.addEventListener("change", () => {
          showFileName(fileInput.files && fileInput.files[0]);
        });
    }

    if(dropzone) {
        // Visual drag-and-drop feedback
        ["dragenter", "dragover"].forEach(evt => {
          dropzone.addEventListener(evt, (e) => {
            e.preventDefault();
            e.stopPropagation();
            dropzone.classList.add("is-dragover");
          });
        });

        ["dragleave", "drop"].forEach(evt => {
          dropzone.addEventListener(evt, (e) => {
            e.preventDefault();
            e.stopPropagation();
            dropzone.classList.remove("is-dragover");
          });
        });

        dropzone.addEventListener("drop", (e) => {
          const files = e.dataTransfer.files;
          if (!files || files.length === 0) return;
          
          // Manually assign files to input (if browser allows) or just show name
          if(fileInput) fileInput.files = files;
          showFileName(files[0]);
        });
    }
</script>
{% endblock %}