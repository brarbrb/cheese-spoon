<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CheeseSpoon — Upload Grade Sheet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>

<body>
  <nav id="top-navbar" class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
        <span>CheeseSpoon</span>
        <img src="{{ url_for('static', filename='logo.png') }}" alt="CheeseSpoon" class="brand-logo" />
      </a>
    </div>
  </nav>

  <main class="container my-4">
    <div class="row justify-content-center">
      <div class="col-lg-8">

        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="alert alert-secondary" role="alert">
              {{ messages[0] }}
            </div>
          {% endif %}
        {% endwith %}

        <div class="feature-card p-4">
          <h4 class="mb-1">Upload Your Grade Sheet</h4>
          <div class="muted small mb-4">
            Step 1 of 3: Upload your Technion grade sheet to extract completed courses.
          </div>

          <form method="POST" enctype="multipart/form-data">
            <!-- Grade Sheet Upload -->
            <div class="form-group">
              <label class="mb-1"><strong>Grade sheet</strong></label>
              <div class="muted small mb-2">PDF or Excel format.</div>

              <div id="dropzone" class="dropzone" role="button" tabindex="0" aria-label="Upload grade sheet">
                <div class="dropzone-inner">
                  <div class="dropzone-title">Drop your file here</div>
                  <div class="muted small">or click to choose a file</div>
                  <div id="fileName" class="dropzone-filename muted small mt-2" style="display:none;"></div>
                </div>

                <input
                  id="gradesFileInput"
                  type="file"
                  name="grades_file"
                  accept=".pdf,.xlsx,.xls"
                  class="dropzone-input"
                  required
                />
              </div>
            </div>

            <div class="alert alert-light small mb-4">
              <strong>What happens next?</strong>
              <ol class="mb-0 small">
                <li>We'll parse your grade sheet to extract completed courses</li>
                <li>You'll review and confirm the extracted courses</li>
                <li>You'll set your preferences and filters</li>
                <li>You'll get personalized course recommendations</li>
              </ol>
            </div>

            <!-- Privacy note -->
            <div class="alert alert-light small mb-4">
              <strong>Privacy Note:</strong> We don't store the original grade sheet — only parsed course IDs.
            </div>

            <div class="d-flex justify-content-between">
              <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">Back to Home</a>
              <button class="btn btn-dark" type="submit">Parse & Continue →</button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // File upload dropzone
    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("gradesFileInput");
    const fileNameEl = document.getElementById("fileName");

    function showFileName(file) {
      if (!file) {
        fileNameEl.style.display = "none";
        fileNameEl.textContent = "";
        return;
      }
      fileNameEl.style.display = "block";
      fileNameEl.textContent = `Selected: ${file.name}`;
    }

    dropzone.addEventListener("click", () => fileInput.click());

    dropzone.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        fileInput.click();
      }
    });

    fileInput.addEventListener("change", () => {
      showFileName(fileInput.files && fileInput.files[0]);
    });

    ["dragenter", "dragover"].forEach(evt => {
      dropzone.addEventListener(evt, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.add("is-dragover");
      });
    });

    ["dragleave", "drop"].forEach(evt => {
      dropzone.addEventListener(evt, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.remove("is-dragover");
      });
    });

    dropzone.addEventListener("drop", (e) => {
      const files = e.dataTransfer.files;
      if (!files || files.length === 0) return;
      fileInput.files = files;
      showFileName(files[0]);
    });
  </script>
</body>
</html>