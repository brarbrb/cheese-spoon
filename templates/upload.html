<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CheeseSpoon — Upload</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>

<body>
  <!-- Same navbar (links to home + upload) -->
  <nav id="top-navbar" class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
        <span>CheeseSpoon</span>
        <img
          src="{{ url_for('static', filename='logo.png') }}"
          alt="CheeseSpoon"
          class="brand-logo"
        />
      </a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#top-navbar-supported-content">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div id="top-navbar-supported-content" class="collapse navbar-collapse">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Home</a></li>
          <li class="nav-item"><a class="nav-link disabled" href="#">Upload</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-4">
    <div class="row justify-content-center">
      <div class="col-lg-8">

        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="alert alert-secondary" role="alert">
              {{ messages[0] }}
            </div>
          {% endif %}
        {% endwith %}

        <div class="feature-card p-4">
          <h4 class="mb-1">Upload & Preferences</h4>
          <div class="muted small mb-4">
            Step 1/3 — we’ll use this to filter eligibility and personalize recommendations.
          </div>

          <form method="POST" enctype="multipart/form-data">
            <!-- Upload -->
            <div class="form-group">
              <label class="mb-1"><strong>Grade sheet</strong></label>
              <div class="muted small mb-2">PDF or Excel.</div>
              <input type="file" class="form-control-file" name="grades_file" accept=".pdf,.xlsx,.xls">
            </div>

            <hr>

            <!-- Faculty / Track / Semester -->
            <div class="form-row">
              <div class="form-group col-md-4">
                <label class="mb-1"><strong>Faculty</strong></label>
                <select class="form-control" name="faculty">
                  <option value="09XXXX" selected>09XXXX (CS/DS faculty)</option>
                  <option value="Electrical">Electrical Engineering</option>
                  <option value="Industrial">Industrial Engineering</option>
                </select>
              </div>

              <div class="form-group col-md-4">
                <label class="mb-1"><strong>Track</strong></label>
                <select class="form-control" name="track">
                  <option value="Software" selected>Software Engineering</option>
                  <option value="DataScience">Data Science</option>
                  <option value="ComputerEng">Computer Engineering</option>
                </select>
              </div>

              <div class="form-group col-md-4">
                <label class="mb-1"><strong>Semester</strong></label>
                <select class="form-control" name="semester">
                  <option value="2026_spring" selected>Spring 2026</option>
                  <option value="2026_winter">Winter 2026</option>
                  <option value="2025_fall">Fall 2025</option>
                </select>
              </div>
            </div>

            <hr>

            <!-- Preference chips -->
            <div class="form-group">
              <label class="mb-1"><strong>Preferences (optional)</strong></label>
              <div class="muted small mb-2">Click chips to add/remove. Add custom ones too.</div>

              <div class="mb-2">
                <button type="button" class="btn btn-sm btn-outline-secondary pref-suggest" data-value="Prefer projects">Prefer projects</button>
                <button type="button" class="btn btn-sm btn-outline-secondary pref-suggest" data-value="Avoid heavy math">Avoid heavy math</button>
                <button type="button" class="btn btn-sm btn-outline-secondary pref-suggest" data-value="2 exams max">2 exams max</button>
                <button type="button" class="btn btn-sm btn-outline-secondary pref-suggest" data-value="Morning classes">Morning classes</button>
              </div>

              <div id="pref-chips" class="pref-chips mb-2"></div>

              <div class="input-group">
                <input id="pref-input" type="text" class="form-control" placeholder="Add preference (e.g., no Friday, prefer OS/ML)">
                <div class="input-group-append">
                  <button id="pref-add" type="button" class="btn btn-outline-dark">Add</button>
                </div>
              </div>

              <!-- Hidden field that will be posted -->
              <input type="hidden" name="preferences_chips" id="preferences_chips" value="">
            </div>

            <!-- Free-text preferences -->
            <div class="form-group">
              <label class="mb-1"><strong>Free-text goals (optional)</strong></label>
              <textarea class="form-control" rows="3" name="preferences_text"
                placeholder="Example: I want ML/NLP courses, moderate workload, avoid 2 midterms, prefer project-based courses."></textarea>
            </div>

            <!-- Privacy note -->
            <div class="alert alert-light small mb-4">
              <strong>Privacy:</strong> We don’t store the original grade sheet — only parsed course IDs (mock statement for prototype).
            </div>

            <div class="d-flex justify-content-between">
              <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">Back</a>
              <button class="btn btn-dark" type="submit">Continue (mock)</button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // --- Preference chips (client-side mock) ---
    const chipsEl = document.getElementById("pref-chips");
    const inputEl = document.getElementById("pref-input");
    const hiddenEl = document.getElementById("preferences_chips");

    const state = new Set();

    function syncHidden() {
      hiddenEl.value = Array.from(state).join(" | ");
    }

    function render() {
      chipsEl.innerHTML = "";
      Array.from(state).forEach(val => {
        const chip = document.createElement("span");
        chip.className = "badge badge-dark pref-chip";
        chip.textContent = val;

        const x = document.createElement("span");
        x.className = "pref-chip-x";
        x.textContent = "×";
        x.title = "Remove";

        x.onclick = () => {
          state.delete(val);
          render();
          syncHidden();
        };

        chip.appendChild(x);
        chipsEl.appendChild(chip);
      });
    }

    function addPref(val) {
      const v = (val || "").trim();
      if (!v) return;
      state.add(v);
      render();
      syncHidden();
    }

    document.querySelectorAll(".pref-suggest").forEach(btn => {
      btn.addEventListener("click", () => addPref(btn.dataset.value));
    });

    document.getElementById("pref-add").addEventListener("click", () => {
      addPref(inputEl.value);
      inputEl.value = "";
      inputEl.focus();
    });

    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addPref(inputEl.value);
        inputEl.value = "";
      }
    });
  </script>
</body>
</html>